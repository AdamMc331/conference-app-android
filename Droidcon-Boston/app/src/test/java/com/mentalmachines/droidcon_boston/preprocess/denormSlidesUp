#!/usr/bin/env kscript
//DEPS com.squareup.moshi:moshi:1.5.0,com.squareup.moshi:moshi-adapters:1.5.0,com.squareup.moshi:moshi-kotlin:1.5.0
//INCLUDE ConferenceDataModels.kt
//INCLUDE ConferenceDataUtils.kt
// note: the @file notation for the above doesn't seem to work yet :-P
// you also might have to put full paths in front of the above files because kscript doesn't know how to look at PWD :-P

import okio.Okio
import java.io.FileInputStream

if (args.size != 1) {
    System.err.println("Usage: denormSlidesUp <jsonfile>")
    kotlin.system.exitProcess(-1)
}
val inputStream = FileInputStream(args.get(0))

val moshi = ConferenceDataUtils.getMoshiInstance()
val jsonAdapter = moshi.adapter(ConferenceDataModel::class.java)
val confData = jsonAdapter.fromJson(Okio.buffer(Okio.source(inputStream)))

ConferenceDataUtils.denormalizeConferenceData(confData)

val denormalizedJson = jsonAdapter.toJson(confData)
println(denormalizedJson)
